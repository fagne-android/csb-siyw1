(this["webpackJsonpreact-redux-coceitos-p71-rtk-query-basics"]=this["webpackJsonpreact-redux-coceitos-p71-rtk-query-basics"]||[]).push([[0],{1255:function(e,t){},1257:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n.n(r),s=n(67),c=n.n(s),o=(n(127),n(20)),i=n(15),u=n(11),d=n(17),j=n(5),l=n.n(j),b=n(10),p=n(19),O=n(7),f=n(79),h=["body"];function m(e){return x.apply(this,arguments)}function x(){return x=Object(p.a)(l.a.mark((function e(t){var n,r,a,s,c,o,i,u=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=n.body,a=Object(f.a)(n,h),s={"Content-Type":"application/json"},c=Object(d.a)(Object(d.a)({method:r?"POST":"GET"},a),{},{headers:Object(d.a)(Object(d.a)({},s),a.headers)}),r&&(c.body=JSON.stringify(r)),e.prev=4,e.next=7,window.fetch(t,c);case 7:return i=e.sent,e.next=10,i.json();case 10:if(o=e.sent,!i.ok){e.next=13;break}return e.abrupt("return",{status:i.status,data:o,headers:i.headers,url:i.url});case 13:throw new Error(i.statusText);case 16:return e.prev=16,e.t0=e.catch(4),e.abrupt("return",Promise.reject(e.t0.message?e.t0.message:o));case 19:case"end":return e.stop()}}),e,null,[[4,16]])}))),x.apply(this,arguments)}m.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m(e,Object(d.a)(Object(d.a)({},t),{},{method:"GET"}))},m.post=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return m(e,Object(d.a)(Object(d.a)({},n),{},{body:t}))};var v=Object(O.d)({sortComparer:function(e,t){return t.date.localeCompare(e.date)}}),g=Object(O.c)("notifications/fetchNotifications",function(){var e=Object(p.a)(l.a.mark((function e(t,n){var r,a,s,c,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=N(r()),s=Object(b.a)(a,1),c=s[0],o=c?c.date:"",e.next=6,m.get("/fakeApi/notifications?since=".concat(o));case 6:return i=e.sent,e.abrupt("return",i.data);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),y=Object(O.e)({name:"notifications",initialState:v.getInitialState(),reducers:{allNotificationsRead:function(e,t){Object.values(e.entities).forEach((function(e){e.read=!0}))}},extraReducers:function(e){e.addCase(g.fulfilled,(function(e,t){var n=t.payload.map((function(e){return Object(d.a)(Object(d.a)({},e),{},{read:!1,isNew:!0})}));Object.values(e.entities).forEach((function(e){e.isNew=!e.read})),v.upsertMany(e,n)}))}}),S=y.actions.allNotificationsRead,w=y.reducer,N=v.getSelectors((function(e){return e.notifications})).selectAll,k=n(4),I=function(){var e,t=Object(u.d)(),n=Object(u.e)(N).filter((function(e){return!e.read})).length;return n>0&&(e=Object(k.jsx)("span",{className:"badge",children:n})),Object(k.jsx)("nav",{children:Object(k.jsxs)("section",{children:[Object(k.jsx)("h1",{children:"Fagne - RTK Query Basics"}),Object(k.jsxs)("div",{className:"navContent",children:[Object(k.jsxs)("div",{className:"navLinks",children:[Object(k.jsx)(o.b,{to:"/",children:"Postagens"}),Object(k.jsx)(o.b,{to:"/users",children:"Usu\xe1rios"}),Object(k.jsxs)(o.b,{to:"/notifications",children:["Notifica\xe7\xf5es ",e]})]}),Object(k.jsx)("button",{className:"button",onClick:function(){t(g())},children:"Recarregar Notifica\xe7\xf5es da API"})]})]})})},A=function(e){var t=e.text,n=void 0===t?"":t,r=e.size,a=void 0===r?"5em":r,s=n?Object(k.jsx)("h4",{children:n}):null;return Object(k.jsxs)("div",{className:"spinner",children:[s,Object(k.jsx)("div",{className:"loader",style:{height:a,width:a}})]})},C=Object(O.d)(),P=C.getInitialState(),T=Object(O.c)("users/fetchUsers",Object(p.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.get("/fakeApi/users");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))),q=Object(O.e)({name:"users",initialState:P,reducers:{},extraReducers:function(e){e.addCase(T.fulfilled,C.setAll)}}).reducer,F=C.getSelectors((function(e){return e.users})),U=F.selectAll,E=F.selectById,M=function(e){var t=e.userId,n=Object(u.e)((function(e){return E(e,t)}));return Object(k.jsxs)("span",{children:["by ",n?n.name:"Unknown author"]})},R=n(88),B=n(89),D=function(e){var t=e.timestamp,n="";if(t){var r=Object(R.a)(t),a=Object(B.a)(r);n="".concat(a," ago")}return Object(k.jsxs)("span",{title:t,children:["\xa0 ",Object(k.jsx)("i",{children:n})]})},J=n(35),K=Object(O.d)({sortComparer:function(e,t){return t.date.localeCompare(e.date)}}),L=K.getInitialState({status:"idle",error:null}),G=Object(O.c)("posts/fetchPosts",Object(p.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.get("/fakeApi/posts");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))),Q=Object(O.c)("posts/addNewPost",function(){var e=Object(p.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.post("/fakeApi/posts",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),z=Object(O.e)({name:"posts",initialState:L,reducers:{reactionAdded:function(e,t){var n=t.payload,r=n.postId,a=n.reaction,s=e.entities[r];s&&s.reactions[a]++},postUpdated:function(e,t){var n=t.payload,r=n.id,a=n.title,s=n.content,c=e.entities[r];c&&(c.title=a,c.content=s)}},extraReducers:function(e){e.addCase(G.pending,(function(e,t){e.status="loading"})).addCase(G.fulfilled,(function(e,t){e.status="succeeded",K.upsertMany(e,t.payload)})).addCase(G.rejected,(function(e,t){e.status="failed",e.error=t.error.message})).addCase(Q.fulfilled,K.addOne)}}),W=z.actions,V=(W.postAdded,W.postUpdated),H=W.reactionAdded,X=z.reducer,Y=K.getSelectors((function(e){return e.posts})),Z=Y.selectAll,$=Y.selectById,_=(Y.selectIds,Object(J.a)([Z,function(e,t){return t}],(function(e,t){return e.filter((function(e){return e.user===t}))}))),ee={thumbsUp:"\ud83d\udc4d",hooray:"\ud83c\udf89",heart:"\u2764\ufe0f",rocket:"\ud83d\ude80",eyes:"\ud83d\udc40"},te=function(e){var t=e.post,n=Object(u.d)(),r=Object.entries(ee).map((function(e){var r=Object(b.a)(e,2),a=r[0],s=r[1];return Object(k.jsxs)("button",{type:"button",className:"muted-button reaction-button",onClick:function(){return n(H({postId:t.id,reaction:a}))},children:[s," ",t.reactions[a]]},a)}));return Object(k.jsx)("div",{children:r})},ne=n(114),re=n(27),ae=Object(ne.a)({reducerPath:"api",baseQuery:Object(re.d)({baseUrl:"/fakeApi"}),tagTypes:["Post"],endpoints:function(e){return{getPosts:e.query({query:function(){return"/posts"},providesTags:["Post"]}),getPost:e.query({query:function(e){return"/posts/".concat(e)}}),addNewPost:e.mutation({query:function(e){return{url:"/posts",method:"POST",body:e}},invalidatesTags:["Post"]})}}}),se=ae.useGetPostsQuery,ce=ae.useGetPostQuery,oe=ae.useAddNewPostMutation,ie=function(e){var t=e.post;return Object(k.jsxs)("article",{className:"post-excerpt",children:[Object(k.jsx)("h3",{children:t.title}),Object(k.jsxs)("div",{children:[Object(k.jsx)(M,{userId:t.user}),Object(k.jsx)(D,{timestamp:t.date})]}),Object(k.jsx)("p",{className:"post-content",children:t.content.substring(0,100)}),Object(k.jsx)(te,{post:t}),Object(k.jsx)(o.b,{to:"/posts/".concat(t.id),className:"button muted-button",children:"View Post"})]},t.id)},ue=function(){var e,t=se(),n=t.data,a=void 0===n?[]:n,s=t.isLoading,c=t.isSuccess,o=t.isError,i=t.error,u=Object(r.useMemo)((function(){var e=a.slice();return e.sort((function(e,t){return t.date.localeCompare(e.date)})),e}),[a]);return s?e=Object(k.jsx)(A,{text:"Buscando na API..."}):c?e=u.map((function(e){return Object(k.jsx)(ie,{post:e},e.id)})):o&&(e=Object(k.jsxs)("div",{children:["Erro ao buscar na API: ",i.toString()]})),Object(k.jsxs)("section",{className:"posts-list",children:[Object(k.jsx)("h2",{children:"Postagens"}),e]})},de=function(){var e=Object(r.useState)(""),t=Object(b.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(""),c=Object(b.a)(s,2),o=c[0],i=c[1],d=Object(r.useState)(""),j=Object(b.a)(d,2),O=j[0],f=j[1],h=oe(),m=Object(b.a)(h,2),x=m[0],v=m[1].isLoading,g=Object(u.e)(U),y=[n,o,O].every(Boolean)&&!v,S=function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y){e.next=12;break}return e.prev=1,e.next=4,x({title:n,content:o,user:O}).unwrap();case 4:a(""),i(""),f(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.error("Failed to save the post: ",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}(),w=g.map((function(e){return Object(k.jsx)("option",{value:e.id,children:e.name},e.id)})),N=v?Object(k.jsx)(A,{size:"30px"}):null;return Object(k.jsxs)("section",{children:[Object(k.jsx)("h2",{children:"Adicionar Nova Postagem"}),Object(k.jsxs)("form",{children:[Object(k.jsx)("label",{htmlFor:"postTitle",children:"T\xedtulo:"}),Object(k.jsx)("input",{type:"text",id:"postTitle",name:"postTitle",placeholder:"What's on your mind?",value:n,onChange:function(e){return a(e.target.value)}}),Object(k.jsx)("label",{htmlFor:"postAuthor",children:"Autor:"}),Object(k.jsxs)("select",{id:"postAuthor",value:O,onChange:function(e){return f(e.target.value)},children:[Object(k.jsx)("option",{value:""}),w]}),Object(k.jsx)("label",{htmlFor:"postContent",children:"Conte\xfado:"}),Object(k.jsx)("textarea",{id:"postContent",name:"postContent",value:o,onChange:function(e){return i(e.target.value)}}),Object(k.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(k.jsx)("button",{type:"button",onClick:S,disabled:!y,children:"Salvar Postagem"}),N]})]})]})},je=function(e){var t=e.match.params.postId,n=Object(u.e)((function(e){return $(e,t)})),a=Object(r.useState)(n.title),s=Object(b.a)(a,2),c=s[0],o=s[1],d=Object(r.useState)(n.content),j=Object(b.a)(d,2),l=j[0],p=j[1],O=Object(u.d)(),f=Object(i.g)();return Object(k.jsxs)("section",{children:[Object(k.jsx)("h2",{children:"Editar Postagem"}),Object(k.jsxs)("form",{children:[Object(k.jsx)("label",{htmlFor:"postTitle",children:"Post Title:"}),Object(k.jsx)("input",{type:"text",id:"postTitle",name:"postTitle",placeholder:"What's on your mind?",value:c,onChange:function(e){return o(e.target.value)}}),Object(k.jsx)("label",{htmlFor:"postContent",children:"Content:"}),Object(k.jsx)("textarea",{id:"postContent",name:"postContent",value:l,onChange:function(e){return p(e.target.value)}})]}),Object(k.jsx)("button",{type:"button",onClick:function(){c&&l&&(O(V({id:t,title:c,content:l})),f.push("/posts/".concat(t)))},children:"Salvar Postagem"})]})},le=function(e){var t,n=e.match.params.postId,r=ce(n),a=r.data,s=r.isFetching,c=r.isSuccess;return s?t=Object(k.jsx)(A,{text:"Carregando do Store..."}):c&&(t=Object(k.jsxs)("article",{className:"post",children:[Object(k.jsx)("h2",{children:a.title}),Object(k.jsxs)("div",{children:[Object(k.jsx)(M,{userId:a.user}),Object(k.jsx)(D,{timestamp:a.date})]}),Object(k.jsx)("p",{className:"post-content",children:a.content}),Object(k.jsx)(te,{post:a}),Object(k.jsx)(o.b,{to:"/editPost/".concat(a.id),className:"button",children:"Editar Postagem"})]})),Object(k.jsx)("section",{children:t})},be=function(){var e=Object(u.e)(U).map((function(e){return Object(k.jsx)("li",{children:Object(k.jsx)(o.b,{to:"/users/".concat(e.id),children:e.name})},e.id)}));return Object(k.jsxs)("section",{children:[Object(k.jsx)("h2",{children:"Usu\xe1rios"}),Object(k.jsx)("ul",{children:e})]})},pe=function(e){var t=e.match.params.userId,n=Object(u.e)((function(e){return E(e,t)})),r=Object(u.e)((function(e){return _(e,t)})).map((function(e){return Object(k.jsx)("li",{children:Object(k.jsx)(o.b,{to:"/posts/".concat(e.id),children:e.title})},e.id)}));return Object(k.jsxs)("section",{children:[Object(k.jsx)("h2",{children:n.name}),Object(k.jsx)("ul",{children:r})]})},Oe=n(115),fe=n.n(Oe),he=function(){var e=Object(u.d)(),t=Object(u.e)(N),n=Object(u.e)(U);Object(r.useLayoutEffect)((function(){e(S())}));var a=t.map((function(e){var t=Object(R.a)(e.date),r=Object(B.a)(t),a=n.find((function(t){return t.id===e.user}))||{name:"Unknown User"},s=fe()("notification",{new:e.isNew});return Object(k.jsxs)("div",{className:s,children:[Object(k.jsxs)("div",{children:[Object(k.jsx)("b",{children:a.name})," ",e.message]}),Object(k.jsx)("div",{title:e.date,children:Object(k.jsxs)("i",{children:[r," ago"]})})]},e.id)}));return Object(k.jsxs)("section",{className:"notificationsList",children:[Object(k.jsx)("h2",{children:"Notifica\xe7\xf5es"}),a]})};var me,xe=function(){return Object(k.jsxs)(o.a,{children:[Object(k.jsx)(I,{}),Object(k.jsx)("div",{className:"App",children:Object(k.jsxs)(i.d,{children:[Object(k.jsx)(i.b,{exact:!0,path:"/",render:function(){return Object(k.jsxs)(a.a.Fragment,{children:[Object(k.jsx)(ue,{}),Object(k.jsx)(de,{})]})}}),Object(k.jsx)(i.b,{exact:!0,path:"/posts/:postId",component:le}),Object(k.jsx)(i.b,{exact:!0,path:"/editPost/:postId",component:je}),Object(k.jsx)(i.b,{exact:!0,path:"/users",component:be}),Object(k.jsx)(i.b,{exact:!0,path:"/users/:userId",component:pe}),Object(k.jsx)(i.b,{exact:!0,path:"/notifications",component:he}),Object(k.jsx)(i.a,{to:"/"})]})})]})},ve=n(40),ge=Object(O.a)({reducer:Object(ve.a)({posts:X,users:q,notifications:w},ae.reducerPath,ae.reducer),middleware:function(e){return e().concat(ae.middleware)}}),ye=n(24),Se=n(39),we=n(121),Ne=n(37),ke=n(42),Ie=n.n(ke),Ae=n(86),Ce=n.n(Ae),Pe=n(119),Te=n(120),qe=["id"],Fe=10,Ue=Ce()(),Ee=localStorage.getItem("randomTimestampSeed");function Me(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Ue()*(t-e+1))+e}Ee?me=new Date(Ee):(Ee=(me=new Date).toISOString(),localStorage.setItem("randomTimestampSeed",Ee)),Ue=Ce()(Ee),Object(Te.setRandom)(Ue),Ie.a.seed(me.getTime());for(var Re,Be=function(e){return e[Me(0,e.length-1)]},De=Object(Ne.factory)({user:{id:Object(Ne.primaryKey)(O.n),firstName:String,lastName:String,name:String,username:String,posts:Object(Ne.manyOf)("post")},post:{id:Object(Ne.primaryKey)(O.n),title:String,date:String,content:String,reactions:Object(Ne.oneOf)("reaction"),comments:Object(Ne.manyOf)("comment"),user:Object(Ne.oneOf)("user")},comment:{id:Object(Ne.primaryKey)(String),date:String,text:String,post:Object(Ne.oneOf)("post")},reaction:{id:Object(Ne.primaryKey)(O.n),thumbsUp:Number,hooray:Number,heart:Number,rocket:Number,eyes:Number,post:Object(Ne.oneOf)("post")}}),Je=function(){var e=Ie.a.name.firstName(),t=Ie.a.name.lastName();return{firstName:e,lastName:t,name:"".concat(e," ").concat(t),username:Ie.a.internet.userName()}},Ke=0;Ke<3;Ke++)for(var Le=De.user.create(Je()),Ge=0;Ge<3;Ge++){var Qe=(Re=Le,{title:Ie.a.lorem.words(),date:Ie.a.date.recent(7).toISOString(),user:Re,content:Ie.a.lorem.paragraphs(),reactions:De.reaction.create()});De.post.create(Qe)}var ze=function(e){return Object(d.a)(Object(d.a)({},e),{},{user:e.user.id})},We=[Se.c.get("/fakeApi/posts",(function(e,t,n){var r=De.post.getAll().map(ze);return t(n.delay(Fe),n.json(r))})),Se.c.post("/fakeApi/posts",(function(e,t,n){var r=e.body;if("error"===r.content)return t(n.delay(Fe),n.status(500),n.json("Server error saving this post!"));r.date=(new Date).toISOString();var a=De.user.findFirst({where:{id:{equals:r.user}}});r.user=a,r.reactions=De.reaction.create();var s=De.post.create(r);return t(n.delay(Fe),n.json(ze(s)))})),Se.c.get("/fakeApi/posts/:postId",(function(e,t,n){var r=De.post.findFirst({where:{id:{equals:e.params.postId}}});return t(n.delay(Fe),n.json(ze(r)))})),Se.c.patch("/fakeApi/posts/:postId",(function(e,t,n){var r=e.body,a=(r.id,Object(f.a)(r,qe)),s=De.post.update({where:{id:{equals:e.params.postId}},data:a});return t(n.delay(Fe),n.json(ze(s)))})),Se.c.get("/fakeApi/posts/:postId/comments",(function(e,t,n){var r=De.post.findFirst({where:{id:{equals:e.params.postId}}});return t(n.delay(Fe),n.json({comments:r.comments}))})),Se.c.post("/fakeApi/posts/:postId/reactions",(function(e,t,n){var r=e.params.postId,a=e.body.reaction,s=De.post.findFirst({where:{id:{equals:r}}}),c=De.post.update({where:{id:{equals:r}},data:{reactions:Object(d.a)(Object(d.a)({},s.reactions),{},Object(ve.a)({},a,s.reactions[a]+=1))}});return t(n.delay(Fe),n.json(ze(c)))})),Se.c.get("/fakeApi/notifications",(function(e,t,n){var r=Ze(void 0,Me(1,5),De);return t(n.delay(Fe),n.json(r))})),Se.c.get("/fakeApi/users",(function(e,t,n){return t(n.delay(Fe),n.json(De.user.getAll()))}))],Ve=we.a.apply(void 0,We),He=new Pe.Server("ws://localhost"),Xe=function(e,t){!function(e,t){e.send(JSON.stringify(t))}(e,{type:"notifications",payload:Ze(t,Me(1,5),De)})};He.on("connection",(function(e){e,e.on("message",(function(t){var n=JSON.parse(t);if("notifications"===n.type){var r=n.payload;Xe(e,r)}}))}));var Ye=["poked you","says hi!","is glad we're friends","sent you a gift"];function Ze(e,t,n){var r,a=new Date;e?r=Object(R.a)(e):(r=new Date(a.valueOf())).setMinutes(r.getMinutes()-15);var s=Object(ye.a)(Array(t)).map((function(){var e=Be(n.user.getAll()),t=Be(Ye);return{id:Object(O.n)(),date:Ie.a.date.between(r,a).toISOString(),message:t,user:e.id}}));return s}Ve.start({onUnhandledRequest:"bypass"}),ge.dispatch(T()),c.a.render(Object(k.jsx)(a.a.StrictMode,{children:Object(k.jsx)(u.a,{store:ge,children:Object(k.jsx)(xe,{})})}),document.getElementById("root"))},127:function(e,t,n){}},[[1257,1,2]]]);
//# sourceMappingURL=main.3e8ec641.chunk.js.map